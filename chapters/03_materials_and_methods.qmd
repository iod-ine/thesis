# Materials and methods {#sec-materials-and-methods}

This chapter describes in detail used datasets, processing techniques and the methods used, and comments on the reasoning behind the choices.
Hopefully, by the end of this chapter the reader will be confident in their ability to recreate the framework from scratch.
The code of the project on my GitHub might be a helpful addition for that.

{{< include 03a_lysva_dataset.qmd >}}

{{< include 03b_individual_trees_dataset.qmd >}}

{{< include 03c_synthetic_forest_datasets.qmd >}}


{{< embed 03c_synthetic_forest.ipynb#fig-synthetic-forest-patch-example-1 >}}


{{< include 03d_training_tree_segmentors.qmd >}}

{{< include 03e_training_segment_processors.qmd >}}

## Matching detected trees to the field inventory ground truth

TODO: Rephrase this. This is directly from the Scientific Reports paper.

To evaluate the results, an automated and deterministic method for matching detected trees to the ground truth data is required.
It should determine which ground truth trees, if any, the detected candidates correspond to.
It should also classify all the trees from both sets as either a true positive, meaning that the ground truth tree was successfully detected, a false negative, meaning that a ground truth tree was not detected, or a false positive, meaning a tree was detected when there is none.

We implemented a matching procedure that considers the locations and heights of the trees, and falls back to using only locations when the height information is not available for the ground truth tree.
It is parametrized by the maximum allowed 2D distance and the maximum height difference between a detected and a ground truth tree to consider them a match.
First, it constructs a distance matrix between the ground truth tree locations and the detected candidates and filters out the pairs for which the distance is larger than the allowed maximum.
It then iterates over the remaining pairs in the order of increasing distance, and marks the pairs with suitable heights in which both trees are not yet assigned a class as a true positive.
The pairs in which one of the trees is already assigned a class are marked as either a false positive or a false negative, and the pairs in which both trees are assigned a class are skipped.
Finally, it marks all unmatched ground truth trees as false negatives, and all unmatched candidate trees as false positives.
